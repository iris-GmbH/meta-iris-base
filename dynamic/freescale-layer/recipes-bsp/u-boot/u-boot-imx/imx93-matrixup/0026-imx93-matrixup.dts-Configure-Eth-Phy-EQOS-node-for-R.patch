From 5d8d348be46496c9fecc80cd1ad74c5eb02b1af3 Mon Sep 17 00:00:00 2001
From: Michael Glembotzki <Michael.Glembotzki@iris-sensing.com>
Date: Fri, 27 Sep 2024 10:44:26 +0200
Subject: [PATCH] imx93-matrixup.dts: Configure Eth-Phy: EQOS node for RMII

---
 arch/arm/dts/imx93-matrixup.dts | 37 ++++++++++++++++++---------------
 1 file changed, 20 insertions(+), 17 deletions(-)

diff --git a/arch/arm/dts/imx93-matrixup.dts b/arch/arm/dts/imx93-matrixup.dts
index be31cd28d5a..ea8fdd88adf 100644
--- a/arch/arm/dts/imx93-matrixup.dts
+++ b/arch/arm/dts/imx93-matrixup.dts
@@ -70,9 +70,10 @@
 &eqos {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_eqos>;
-	phy-mode = "rgmii-id";
+	phy-mode = "rmii";
 	phy-handle = <&ethphy1>;
 	status = "okay";
+	assigned-clock-rates = <100000000>, <50000000>;
 
 	mdio {
 		compatible = "snps,dwmac-mdio";
@@ -80,9 +81,13 @@
 		#size-cells = <0>;
 		clock-frequency = <5000000>;
 
-		ethphy1: ethernet-phy@1 {
-			reg = <1>;
+		ethphy1: ethernet-phy@0 {
+			compatible = "ethernet-phy-ieee802.3-c22";
+			reg = <0>;
 			eee-broken-1000t;
+			reset-gpios = <&gpio3 21 GPIO_ACTIVE_LOW>;
+			reset-assert-us = <10000>;
+			reset-deassert-us = <80000>;
 		};
 	};
 };
@@ -255,20 +260,18 @@
 &iomuxc {
 	pinctrl_eqos: eqosgrp {
 		fsl,pins = <
-			MX93_PAD_ENET1_MDC__ENET_QOS_MDC			0x57e
-			MX93_PAD_ENET1_MDIO__ENET_QOS_MDIO			0x57e
-			MX93_PAD_ENET1_RD0__ENET_QOS_RGMII_RD0			0x57e
-			MX93_PAD_ENET1_RD1__ENET_QOS_RGMII_RD1			0x57e
-			MX93_PAD_ENET1_RD2__ENET_QOS_RGMII_RD2			0x57e
-			MX93_PAD_ENET1_RD3__ENET_QOS_RGMII_RD3			0x57e
-			MX93_PAD_ENET1_RXC__CCM_ENET_QOS_CLOCK_GENERATE_RX_CLK	0x5fe
-			MX93_PAD_ENET1_RX_CTL__ENET_QOS_RGMII_RX_CTL		0x57e
-			MX93_PAD_ENET1_TD0__ENET_QOS_RGMII_TD0			0x57e
-			MX93_PAD_ENET1_TD1__ENET_QOS_RGMII_TD1			0x57e
-			MX93_PAD_ENET1_TD2__ENET_QOS_RGMII_TD2			0x57e
-			MX93_PAD_ENET1_TD3__ENET_QOS_RGMII_TD3			0x57e
-			MX93_PAD_ENET1_TXC__CCM_ENET_QOS_CLOCK_GENERATE_TX_CLK	0x5fe
-			MX93_PAD_ENET1_TX_CTL__ENET_QOS_RGMII_TX_CTL		0x57e
+			MX93_PAD_ENET1_MDC__ENET_QOS_MDC                        0x57e
+			MX93_PAD_ENET1_MDIO__ENET_QOS_MDIO                      0x57e
+			MX93_PAD_ENET1_RD0__ENET_QOS_RGMII_RD0                  0x57e
+			MX93_PAD_ENET1_RD1__ENET_QOS_RGMII_RD1                  0x57e
+			MX93_PAD_ENET1_RX_CTL__ENET_QOS_RGMII_RX_CTL            0x57e
+			MX93_PAD_ENET1_TD0__ENET_QOS_RGMII_TD0                  0x57e
+			MX93_PAD_ENET1_TD1__ENET_QOS_RGMII_TD1                  0x57e
+			MX93_PAD_ENET1_TX_CTL__ENET_QOS_RGMII_TX_CTL            0x57e
+			MX93_PAD_ENET1_RXC__ENET_QOS_RX_ER                      0x57e
+			MX93_PAD_ENET1_TD2__CCM_ENET_QOS_CLOCK_GENERATE_REF_CLK 0x400005fe
+			MX93_PAD_SD3_CMD__GPIO3_IO21                            0x31e /* E_NRST */
+			MX93_PAD_SD3_DATA0__GPIO3_IO22                          0x31e /* E_INT */
 		>;
 	};
 
-- 
2.46.0

